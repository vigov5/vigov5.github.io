---
layout: post
title:  "Elixir v√† Unicode, Ph·∫ßn 1: Unicode v√† UTF-8 l√† g√¨ ?"
date: 2017-07-29 12:53:00 +0700
categories: unicode elixir
---

# Intro

ƒê√¢y l√† b√†i d·ªãch ƒë·∫ßu ti√™n trong series v·ªÅ Elixir v√† Unicode c·ªßa t√°c gi·∫£ **Nathan Long**, C√°c b·∫°n c√≥ th·ªÉ ƒë·ªçc ph·∫ßn 2 t·∫°i [ƒë√¢y]({% post_url 2017-08-19-elixir-va-unicode-phan-2-lam-viec-voi-unicode-strings %})<br>
B√†i g·ªëc: [Part 1](https://www.bignerdranch.com/blog/unicode-and-utf-8-explained/) | [Part 2](https://www.bignerdranch.com/blog/elixir-and-unicode-part-2-working-with-unicode-strings/)<br>
ƒê√¢y l√† m·ªôt series r·∫•t chi ti·∫øt v√† d·ªÖ hi·ªÉu, m√¨nh c√≥ ch·ªânh s·ª≠a v√† b·ªï sung 1 ch√∫t, hi v·ªçng ƒëem ƒë·∫øn cho m·ªçi ng∆∞·ªùi 1 c√°i nh√¨n r√µ r√†ng nh·∫•t v·ªÅ Unicode v√† UTF-8, th·ª© ch√∫ng ta g·∫∑p r·∫•t nhi·ªÅu nh∆∞ng ch∆∞a ch·∫Øc ƒë√£ bi·∫øt r√µ :)

---

B√†i vi·∫øt n√†y l√† b√†i vi·∫øt ƒë∆∞·ª£c ƒë√∫c r√∫t ra t·ª´ b√†i n√≥i "String Theory" m√† t√¥i l√† ƒë·ªìng di·ªÖn gi·∫£ v·ªõi James Edward Gray II t·∫°i h·ªôi th·∫£o Elixir & Phoenix Conf nƒÉm 2016.<br>
C√≥ th·ªÉ b·∫°n ƒë√£ t·ª´ng nghe n√≥ r·∫±ng Elixir h·ªó tr·ª£ Unicode c·ª±c k√¨ t·ªët. ƒêi·ªÅu n√†y t·∫°o n√™n m·ªôt ng√¥n ng·ªØ tuy·ªát v·ªùi cho m·ª•c ƒë√≠ch t√≠nh to√°n song song, ph√¢n t√°n, nh·ªØng app ch·ªëng l·ªói hi·ªáu qu·∫£, v√† c√≥ th·ªÉ l√† gi√∫p ch√∫ng ta g·ª≠i nh·ªØng emo like this üí©<br>
ƒê·∫∑c bi·ªát h∆°n n·ªØa, Elixir c√≤n v∆∞·ª£t qua 1 c√°ch ho√†n h·∫£o nh·ªØng b√†i test ƒë∆∞·ª£c khuy·∫øn c√°o t·∫°i [The String Type is Broken](https://mortoray.com/2013/11/27/the-string-type-is-broken/). <br>
B√†i vi·∫øt n√†y c√≥ n√≥i r·∫±ng ph·∫ßn l·ªõn c√°c ng√¥n ng·ªØ ƒë·ªÅu t·∫°ch ·ªü m·ªôt s·ªë b√†i ki·ªÉm tra, v√† th√†nh t√≠ch t·ªá h·∫°i thu·ªôc v·ªÅ C#, C++, Java, JavaScript, Perl (t√°c gi·∫£ kh√¥ng n√≥i c·ª• th·ªÉ l√† version n√†o). Tuy nhi√™n, ·ªü ƒë√¢y t√¥i s·∫Ω so s√°nh nh·ªØng ng√¥n ng·ªØ m√† t√¥i hay s·ª≠ d·ª•ng nh·∫•t: Elixir (version 1.3.2), Ruby (version 2.4.0-preview1) v√† JavaScript (run in v8 engine version 4.6.85.31).<br>
D∆∞·ªõi ƒë√¢y l√† k·∫øt qu·∫£: (trong n√†y c√≥ s·ª≠ d·ª•ng m·ªôt s·ªë thu·∫≠t ng·ªØ **codepoints** v√† **normalized**, t√¥i s·∫Ω gi·∫£i th√≠ch 2 thu·∫≠t ng·ªØ n√†y sau)

![](https://viblo.asia/uploads/1a0faf11-cf4b-46ed-9f98-af7978cc962d.png)

(Shame on other languages :P)

OK, V·∫≠y l√†m th·∫ø n√†o m√† Elixir c√≥ th·ªÉ h·ªó tr·ª£ Unicode t·ªët ƒë·∫øn nh∆∞ v·∫≠y ?? D√π b·∫°n h·ªèi (hay l√† gi·∫£ v·ªù h·ªèi) th·∫ø n√†o n·ªØa th√¨ tr∆∞·ªõc h·∫øt h√£y c√πng t√¨m hi·ªÉu √Ω t∆∞·ªüng (concept) t·∫°o n√™n Unicode. Let's go ~

# Unicode l√† g√¨ ?

Unicode th√¨ th·ª±c s·ª± l√† b√° ƒë·∫°o nh∆∞ng kh√¥ng may, ·∫•n t∆∞·ª£ng ƒë·∫ßu ti√™n c·ªßa t√¥i v·ªÅ Unicode l√† nh·ªØng k√≠ t·ª± √¥ vu√¥ng ki·ªÉu nh∆∞ th·∫ø n√†y:

![](https://viblo.asia/uploads/c405f8a3-bccc-4596-bddb-1175f89ca13c.jpg)

Source: [Zazzle](http://www.zazzle.com/i_heart_unicode_coffee_mug-168595432662787689)

Tr∆∞·ªõc khi n√≥i v·ªÅ Unicode, h√£y n√≥i v·ªÅ ASCII, th·ª© m√† nh·ªØng ng∆∞·ªùi n√≥i ti·∫øng Anh nh∆∞ t√¥i khi nh·∫Øc ƒë·∫øn s·∫Ω nghƒ© ngay ƒë·∫øn nh·ªØng ƒëo·∫°n vƒÉn b·∫£n th√¥ng th∆∞·ªùng. N·∫øu ch·∫°y l·ªánh `man ascii` tr√™n m√°y c·ªßa b·∫°n, b·∫°n s·∫Ω nh·∫≠n ƒë∆∞·ª£c k·∫øt qu·∫£ t∆∞∆°ng t·ª± nh∆∞ th·∫ø n√†y.


![](https://viblo.asia/uploads/ae606b98-d05f-4f54-8f31-295504bb9b99.png)

V·ªÅ c∆° b·∫£n, ASCII ƒë∆°n gi·∫£n l√† m·ªôt c√°ch √°nh x·∫° (mapping) t·ª´ k√≠ t·ª± sang s·ªë. ƒê√¢y l√† s·ª± ƒë·ªìng √Ω gi·ªØa c√°c l·∫≠p tr√¨nh vi√™n r·∫±ng ch·ªØ a hoa, **A**, c√≥ th·ªÉ ƒë∆∞·ª£c bi·ªÉu di·ªÖn b·∫±ng s·ªë **65** v√† t∆∞∆°ng t·ª± cho c√°c k√≠ t·ª± kh√°c (T·∫°i sao l·∫°i l√† 65 ??? c√≥ [l√≠ do](https://stackoverflow.com/questions/1136156/is-there-any-logic-behind-ascii-codes-ordering/1136198#1136198) ri√™ng cho vi·ªác n√†y ƒë·∫•y :D). S·ªë ƒë∆∞·ª£c g√°n cho m·ªôt k√≠ t·ª± s·∫Ω ƒë∆∞·ª£c g·ªçi l√† **codepoint** c·ªßa k√≠ t·ª± ƒë√≥.<br>
ƒê·ªÉ *encode* ASCII - l∆∞u n√≥ d∆∞·ªõi d·∫°ng m√† ch√∫ng ta c√≥ th·ªÉ l∆∞u tr·ªØ ho·∫∑c truy·ªÅn ƒëi ƒë∆∞·ª£c - r·∫•t ƒë∆°n gi·∫£n. B·∫°n ch·ªâ c·∫ßn chuy·ªÉn codepoint sang c∆° s·ªë 2 v√† th√™m v√†o ph√≠a tr√°i (pad) c√°c s·ªë 0 ƒë·ªÉ cho ƒë·ªß 8-bit (t∆∞∆°ng ƒë∆∞∆°ng 1 byte). ƒê·ªëi v·ªõi Elixir ch√∫ng ta s·∫Ω l√†m nh∆∞ sau:

```elixir
base_2 = fn (i) ->
  Integer.to_string(i, 2)
end

# A ? gives us the codepoint
?a == 97
?a |> base_2.() |> String.pad_leading(8, ["0"]) == "01100001"
```

B·ªüi v√¨ ch·ªâ c√≥ 128 k√≠ t·ª± ASCII n√™n d·ªØ li·ªáu th·ª±c s·ª± kh√¥ng bao gi·ªù d√†i h∆°n 7 bit, n√™n khi ch√∫ng ta *encode* `a` s·∫Ω c√≥ 1 s·ªë 0 th·ª´a ·ªü ƒë·∫ßu nh∆∞ sau.

![](https://viblo.asia/uploads/75493012-d369-4690-859d-38cbb4480081.png)

T·∫°m th·ªùi ch√∫ng ta v·∫´n ·ªïn v·ªõi c√°ch encode n√†y, nh∆∞ng ch√∫ng ta mu·ªën vi·∫øt nhi·ªÅu h∆°n nh·ªØng k√≠ t·ª± th√¥ng th∆∞·ªùng. Ch√∫ng ta mu·ªën vi·∫øt:

- Nh·ªØng k√≠ t·ª± ƒëi k√®m v·ªõi tr·ªçng √¢m
> √° √© √≠ √≥ √∫ √º √± ≈∫ ƒë·∫πp trai

- Ch·ªØ Hi L·∫°p
> Œª œÜ Œ∏ Œ©

- K√≠ hi·ªáu to√°n h·ªçc
> ‚à´f(x)dx ‚àû ‚ñ≥ABC ~ ‚ñ≥DEF

- Ch·ªØ t∆∞·ª£ng h√¨nh Trung Qu·ªëc
> Â§úÈú≤Ê≠ªËã¶

- V·∫Ω tranh ch·∫Øc c≈©ng kh√¥ng ch·∫øt ai ƒë√¢u nh·ªâ
> †úé = üêì + üó°  (Ch·ªØ H√†n n√†y c√≥ nghƒ©a l√† "thi·∫øn g√†")

- Ta c√≤n mu·ªën vi·∫øt emoji n·ªØa: c∆∞·ªùi, kh√≥c, h√¥n, l·∫≠t m·∫∑t, h√°m ti·ªÅn,...
> üòÜ  üò≠  üòò  üôÉ  ü§ë

V·ªõi Unicode, ta c√≥ th·ªÉ vi·∫øt t·∫•t c·∫£ c√°c k√≠ t·ª± c·ªßa t·∫•t c·∫£ c√°c ng√¥n ng·ªØ c·ªßa con ng∆∞·ªùi (tr√™n l√Ω thuy·∫øt l√† v·∫≠y)<br>
Th·ª±c t·∫ø th√¨, Unicode ƒë∆∞·ª£c t·∫°o ra nh∆∞ m·ªôt chu·∫©n m·ª±c nh∆∞ng n√≥ c≈©ng l√† m·ªôt qu√° tr√¨nh li√™n quan ƒë·∫øn ch√≠nh tr·ªã, v√† c√≥ ai ƒë√≥ n√≥i r·∫±ng, ng√¥n ng·ªØ c·ªßa h·ªç kh√¥ng ƒë∆∞·ª£c ƒë·ªëi x·ª≠ c√¥ng b·∫±ng nh∆∞ c√°c ng√¥n ng·ªØ kh√°c. V√≠ d·ª•, trong b√†i vi·∫øt [I Can Text You A Pile of Poo, But I Can‚Äôt Write My Name](https://modelviewculture.com/pieces/i-can-text-you-a-pile-of-poo-but-i-cant-write-my-name) (T·∫°m d·ªãch: t√¥i c√≥ th·ªÉ nh·∫Øn cho b·∫°n c·∫£ 1 ƒë·ªëng sh!t nh∆∞ng l·∫°i kh√¥ng th·ªÉ vi·∫øt t√™n m√¨nh 1 c√°ch h·∫≥n hoi) t√°c gi·∫£ **Aditya Mukerjee** c√≥ gi·∫£i th√≠ch r·∫±ng, ng√¥n ng·ªØ Bengal (m·ªôt ng√¥n ng·ªØ ·ªü v√πng Nam √Å) c√≥ h∆°n 200 tri·ªáu ng∆∞·ªùi b·∫£n x·ª© s·ª≠ d·ª•ng, nhi·ªÅu h∆°n c·∫£ ti·∫øng Nga nh∆∞ng kh√¥ng ph·∫£i l√∫c n√†o c≈©ng c√≥ th·ªÉ g√µ 1 c√°ch h·∫≥n hoi tr√™n m√°y t√≠nh.<br>
T∆∞∆°ng t·ª±, nh·ªØng ng∆∞·ªùi vi·∫øt ti·∫øng Trung, H√†n, Nh·∫≠t c≈©ng b·ªã b·∫£o nh∆∞ sau: N√†y, c√°c b·∫°n s·∫Ω s·ª≠ d·ª•ng chung "[Han unification](https://en.wikipedia.org/wiki/Han_unification)", nh∆∞ v·∫≠y ch√∫ng ta s·∫Ω ti·∫øt ki·ªám th√™m ƒë∆∞·ª£c v√†i ch·ªó tr·ªëng ;)"
![](https://viblo.asia/uploads/5b05fc85-3b1e-4835-83a6-0756ed45938d.png)

Source: [The Sorry State of Japanese on the Internet](https://www.tofugu.com/japan/japanese-internet/)

Ho·∫∑c √≠t nh·∫•t l√† ƒë·∫•y l√† [c√°ch m√† h·ªç gi·∫£i th√≠ch c√°c k√≠ t·ª± tr√™n](https://www.tofugu.com/japan/japanese-internet/). C√≥ m·ªôt b√†i vi·∫øt tr√™n trang ch·ªß c·ªßa Unicode gi·∫£i th√≠ch v·ªÅ ng√¥n ng·ªØ h·ªçc, t√≠nh l·ªãch s·ª≠ c≈©ng nh∆∞ c√°c l√≠ do kƒ© thu·∫≠t. B√†i n√†y c≈©ng c√≥ nh·∫Øc ƒë·∫øn:
> Qu√° tr√¨nh n√†y ƒë∆∞·ª£c nh·∫≠n th·ª©c r·∫•t r√µ b·ªüi ti√™u chu·∫©n qu·ªëc gia c·ªßa c√°c n∆∞·ªõc tham gia, Nh·∫≠t B·∫£n, Trung Qu·ªëc, H√†n Qu·ªëc v√† c√°c n∆∞·ªõc kh√°c, t·∫•t c·∫£ ƒë·ªÅu c√πng nhau tham gia v√†o ph·∫ßn l·ªõn c√¥ng vi·ªác bao g·ªìm t·ªëi thi·ªÉu ho√° nh·ªØng m√£ ho√° m√† t·∫•t c·∫£ c√°c th√†nh vi√™n kh√°c c·ªßa u·ª∑ ban ƒë·ªÅu ƒë·ªëng √Ω r·∫±ng ch√∫ng l√† c·ªßa c√πng m·ªôt k√≠ t·ª±.

ƒê·ªëi v·ªõi t√¥i, m·ªôt ng∆∞·ªùi kh√¥ng vi·∫øt b·∫•t c·ª© ng√¥n ng·ªØ n√†o ƒë∆∞·ª£c n√≥i ·ªü tr√™n, t√¥i ch·∫≥ng th·ªÉ ƒë√°nh gi√° ƒë∆∞·ª£c. Nh∆∞ng n·∫øu m√† l·∫•y vi·ªác ti·∫øt ki·ªám ch·ªó tr·ªëng l√†m l√≠ do kƒ© thu·∫≠t th√¨ c√≥ v·∫ª l·∫° khi m√† Unicode c√≥ c·∫£ b·∫£ng m√£ cho b√†i t√∫ l∆° kh∆° ???

![](https://viblo.asia/uploads/ddb72563-290a-44da-aaf5-75caa06eece9.png)
Hay l√† c·∫£ k√≠ t·ª± gi·∫£ kim thu·∫≠t...
![](https://viblo.asia/uploads/d8621326-5212-42ab-8cf9-26738ec5454b.png)

v√† k√≠ hi·ªáu √¢m nh·∫°c c·ªßa Hi L·∫°p c·ªï ƒë·∫°i...
![](https://viblo.asia/uploads/52c52f7d-ba7b-47f9-8b50-bf3182e536ed.png)
√† v√† c·∫£ [Linear B](http://www.unicode.org/charts/PDF/U10000.pdf), th·ª© m√† ch·∫£ ai d√πng ƒë√£ c·∫£ ngh√¨n nƒÉm r·ªìi (wtf).<br>
Nh∆∞ng ƒë·ªëi v·ªõi m·ª•c ƒë√≠ch c·ªßa b√†i vi·∫øt n√†y, c√°i quan tr·ªçng m√† t√¥i mu·ªën n√≥i ƒë·∫øn l√† **Unicode tr√™n l√Ω thuy·∫øt c√≥ th·ªÉ h·ªó tr·ª£ b·∫•t c·ª© th·ª© g√¨ ch√∫ng ta mu·ªën g√µ ·ªü b·∫•t k√¨ ng√¥n ng·ªØ n√†o**<br>
·ªû l√µi c·ªßa m√¨nh, Unicode gi·ªëng nh∆∞ ASCII: 1 danh s√°ch c√°c k√≠ t·ª± m√† ch√∫ng ta mu·ªën g√µ v√†o m√°y t√≠nh. M·ªói k√≠ t·ª± s·∫Ω t∆∞∆°ng ·ª©ng v·ªõi m·ªôt s·ªë (numberic codepoint), cho d√π n√≥ l√† ch·ªØ a hoa, A, ch·ªØ lambda th∆∞·ªùng, ho·∫∑c l√† "[ng∆∞·ªùi ƒë√†n √¥ng l∆° l·ª≠ng trong b·ªô vest](http://emojipedia.org/man-in-business-suit-levitating/)".

```
A = 65
Œª = 923
üï¥= 128,372 # <- best emoji ever
```

Unicode n√≥i: "Ok, k√≠ t·ª± n√†y t·ªìn t·∫°i, ch√∫ng t√¥i ƒë√£ g·∫Øn cho n√≥ m·ªôt t√™n ch√≠nh th·ª©c v√† m·ªôt codepoint, ƒë√¢y l√† n√≥ ·ªü d·∫°ng ch·ªØ th∆∞·ªùng v√† d·∫°ng ch·ªØ hoa (n·∫øu c√≥), v√† ƒë√¢y (c√≥ th·ªÉ) l√† ·∫£nh c·ªßa n√≥. N√†y nh·ªØng nh√† thi·∫øt k·∫ø font ch·ªØ, n√≥ hi·ªÉn th·ªã th·∫ø n√†o ch·ªâ ph·ª• thu·ªôc v√†o c√°ch b·∫°n v·∫Ω n√≥ th√¥i ƒë·∫•y."
<br>Gi·ªëng nh∆∞ ASCII, c√°c Unicode string (h√£y t∆∞·ªüng t∆∞·ª£ng n√≥ l√† m·ªôt chu·ªói "codepoint 121, codepoint 111...") c·∫ßn ph·∫£i ƒë∆∞·ª£c encode th√†nh 0 v√† 1 tr∆∞·ªõc khi ta c√≥ th·ªÉ l∆∞u tr·ªØ v√† truy·ªÅn ch√∫ng ƒëi. Nh∆∞ng kh√¥ng gi·ªëng nh∆∞ ASCII, Unicode c√≥ nhi·ªÅn h∆°n 1 tri·ªáu codepoint, n√™n ta kh√¥ng th·ªÉ nh√©t v·ª´a t·∫•t c·∫£ v√†o 1 byte ƒë∆∞·ª£c. V√† kh√¥ng gi·ªëng nh∆∞ ASCII, ch√∫ng ta KH√îNG C√ì 1 C√ÅCH DUY NH·∫§T ƒë·ªÉ encode ch√∫ng.
<br>V·∫≠y ta c√≥ th·ªÉ l√†m g√¨ ? 1 √Ω t∆∞·ªüng ƒë√≥ l√† c·ª© 3 byte t∆∞∆°ng ·ª©ng v·ªõi 1 k√≠ t·ª±. N·∫øu th·∫ø th√¨ s·∫Ω r·∫•t d·ªÖ cho vi·ªác duy·ªát string v√¨ codepoint th·ª© 3 s·∫Ω lu√¥n b·∫Øt ƒë·∫ßu ·ªü byte s·ªë 7. Tuy nhi√™n, v·ªÅ m·∫∑t kh√¥ng gian l∆∞u tr·ªØ v√† bƒÉng th√¥ng th√¨ c√°ch l√†m n√†y kh√¥ng hi·ªáu qu·∫£.
<br>Thay v√¨ v·∫≠y, gi·∫£i ph√°p ph·ªï bi·∫øn nh·∫•t ƒë√≥ l√† c√°ch m√£ ho√° **UTF-8**

# UTF-8

UTF-8 ƒë∆∞a ra cho ch√∫ng ta 4 m·∫´u (template) ƒë·ªÉ l·ª±a ch·ªçn: m·∫´u 1 byte, m·∫´u 2 byte, m·∫´u 3 byte, m·∫´u 4 byte
![](https://viblo.asia/uploads/810acc07-083b-4493-9534-fc80fe0f3010.png)
ƒê·ªëi v·ªõi m·ªói template s·∫Ω c√≥ nh·ªØng ph·∫ßn header gi·ªëng nhau (ƒë√°nh d·∫•u b·∫±ng m√†u ƒë·ªè trong h√¨nh tr√™n) v√† nh·ªØng v·ªã tr√≠ m√† ta c√≥ th·ªÉ ƒëi·ªÅn d·ªØ li·ªáu codepoint v√†o (ƒë√°nh d·∫•u b·∫±ng "x" ·ªü ph·∫ßn tr√™n).
<br>Template 4 byte cho ph√©p ta l∆∞u tr·ªØ 21 bit, t∆∞∆°ng ƒë∆∞∆°ng v·ªõi 2,097,151 gi√° tr·ªã kh√°c nhau, qu√° d∆∞ ƒë·ªß so v·ªõi 128,000 codepoint hi·ªán t·∫°i. N√™n l√†, t∆∞∆°ng lai n·∫øu c√≥ th√™m nhi·ªÅu Unicode codepoint n·ªØa th√¨ UTF-8 c≈©ng d·ªÖ d√†ng m√£ ho√° ƒë∆∞·ª£c.
<br>ƒê·ªÉ s·ª≠ d·ª•ng c√°c template n√†y, ƒë·∫ßu ti√™n b·∫°n c·∫ßn bi·ªÉu di·ªÖn codepoint ƒë√≥ d∆∞·ªõi d·∫°ng c√°c bit.
<br>V√≠ d·ª•, ‚è∞  c√≥ codepoint l√† 9200 (trong `iex` b·∫°n c√≥ th·ªÉ d√πng `?` ƒë·ªÉ th·∫•y gi√° tr·ªã n√†y)

```elixir
?‚è∞  # => 9200
```

Chuy·ªÉn s·ªë ƒë√≥ sang h·ªá c∆° s·ªë 2:

```elixir
base_2.(?‚è∞) == "10001111110000"
```

T·ªïng c·ªông l√† 14 bit, kh√¥ng ƒë·ªß n·∫øu ch√∫ng ta d√πng template 2 byte, nh∆∞ng v·ªõi 3 byte th√¨ ok. Ch√∫ng ta s·∫Ω ch√®n ch√∫ng v√†o c√°c v·ªã tr√≠ l∆∞u codepoint, t·ª´ ph·∫£i sang tr√°i v√† pad ph·∫ßn tr·ªëng b·∫±ng s·ªë 0 nh∆∞ h√¨nh d∆∞·ªõi:
![](https://viblo.asia/uploads/a462a759-72ed-469d-b7c5-6a4335ac4c55.png)
C∆° m√† ƒë√¢y c√≥ ph·∫£i l√† ƒëi·ªÅu m√† Elixir th·ª±c s·ª± l√†m kh√¥ng ? Trong `iex`, ta c√≥ th·ªÉ d√πng h√†m `IEx.Helpers.i/1` ƒë·ªÉ ki·ªÉm tra 1 string c√≥ ch·ª©a ‚è∞  nh∆∞ sau:

```elixir
i "‚è∞"
....
Raw representation
  <<226, 143, 176>>
```

Ta c√≥ th·ªÉ th·∫•y string n√†y ƒë∆∞·ª£c bi·ªÉu di·ªÖn nh∆∞ 1 chu·ªói nh·ªã ph√¢n g·ªìm 3 byte. Trong Elixir, "bitstring" l√† b·∫•t c·ª© c√°i g√¨ n·∫±m gi·ªØa `<<` v√† `>>` l√† m·ªôt chu·ªói li√™n ti·∫øp c√°c bit trong b·ªô nh·ªõ. N·∫øu chu·ªói ƒë√≥ c√≥ s·ªë bit chia h·∫øt cho 8, ta g·ªçi ch√∫ng l√† "binary" - chu·ªói c√°c byte. V√† n·∫øu c√°c byte ƒë√≥ l√† UTF-8 h·ª£p l·ªá th√¨ n√≥ s·∫Ω ƒë∆∞·ª£c g·ªçi l√† "string".
<br>Ba s·ªë ·ªü tr√™n l√† bi·ªÉu di·ªÖn th·∫≠p ph√¢n c·ªßa 3 byte c·ªßa "binary", ta c√≥ th·ªÉ chuy·ªÉn ch√∫ng sang c∆° s·ªë 2 nh∆∞ sau:

```Elixir
[226, 143, 176] |> Enum.map(base_2)
# => ["11100010", "10001111", "10110000"]
```

Yeah, ƒë√∫ng y chang nh·ªØng g√¨ ta l√†m ·ªü ph√≠a tr√™n. hehe

# Ba ki·ªÉu byte c·ªßa UTF-8

UTF-8 ƒë·∫πp trai (cool) v√¨ ch·ªâ c·∫ßn nh√¨n v√†o nh·ªØng byte ƒë√≥, b·∫°n c√≥ th·ªÉ nh·∫≠n ra ngay n√≥ thu·ªôc lo·∫°i n√†o, d·ª±a v√†o n√≥ b·∫Øt ƒë·∫ßu b·∫±ng g√¨. C√≥ nh·ªØng "**solo**" byte (byte ch·ª©a to√†n b·ªô m·ªôt code point, b·∫Øt ƒë·∫ßu b·∫±ng 0), "**leading**" byte (byte ƒë·∫ßu ti√™n trong 1 v√†i codepoint) b·∫Øt ƒë·∫ßu b·∫±ng 11 (c√≥ th·ªÉ l√† c√≥ c·∫£ nh·ªØng s·ªë 1 kh√°c ·ªü sau ƒë√≥) v√† "**continuation**"  byte (nh·ªØng byte th√™m c·ªßa codepoint), b·∫Øt ƒë·∫ßu b·∫±ng 10. Leading bytes cho b·∫°n bi·∫øt s·∫Øp t·ªõi c√≥ bao nhi√™u continuation byte: n·∫øu b·∫Øt ƒë·∫ßu l√† 110 th√¨ codepoint s·∫Ω c√≥ 2 byte, n·∫øu b·∫Øt ƒë·∫ßu l√† 1110, s·∫Ω c√≥ 3 byte trong codepoint, v√¢n v√¢n v√† m√¢y m√¢y...

![](https://viblo.asia/uploads/68de5bfc-746b-48a0-a096-f75e2ef47588.png)
D∆∞·ªõi ƒë√¢y l√† v√≠ d·ª• cho c√°c template c·ªßa UTF-8:
![](https://viblo.asia/uploads/2ef66054-e3d8-4207-9d26-28c07cb8144f.png)

Ch·ªØ c√°i `a` ƒë∆∞·ª£c m√£ ho√° b·∫±ng 1 solo byte - 1 byte duy nh·∫•t b·∫Øt ƒë·∫ßu b·∫±ng 0. K√≠ t·ª± "khoai lang n∆∞·ªõng" c√≥ leading byte b·∫Øt ƒë·∫ßu b·∫±ng 4 s·ªë 1, nghƒ©a l√† n√≥ d√†i 4 byte v√† sau ƒë√¢y s·∫Ω c√≤n 3 continuation byte n·ªØa b·∫Øt ƒë·∫ßu b·∫±ng 10.
<br>Th√™m n·ªØa, m√£ ho√° c·ªßa 'a' ·ªü UTF-8 gi·ªëng h·ªát nh∆∞ ASCII. Th·ª±c t·∫ø th√¨ b·∫•t c·ª© ƒëo·∫°n text ASCII n√†o c≈©ng c√≥ th·ªÉ coi l√† UTF-8, nghƒ©a l√† n·∫øu b·∫°n c√≥ m·ªôt ƒëo·∫°n text ASCII r·ªìi, b·∫°n c√≥ th·ªÉ ƒë∆°n gi·∫£n tuy√™n b·ªë: "OK, gi·ªù n√≥ l√† UTF-8 r·ªìi nh√©" v√† b·∫Øt ƒë·∫ßu th√™m c√°c k√≠ t·ª± Unicode v√†o.
<br>Vi·ªác c√°c lo·∫°i byte b·∫Øt ƒë·∫ßu m·ªôt c√°ch kh√°c nhau cho ph√©p ta c√≥ th·ªÉ ƒë·ªçc UTF-8 t·ª´ gi·ªØa file ho·∫∑c stream d·ªØ li·ªáu, v√† n·∫øu b·∫°n c√≥ r∆°i v√†o gi·ªØa 1 k√≠ t·ª± th√¨ b·∫°n c≈©ng bi·∫øt l√†m th·∫ø n√†o ƒë·ªÉ b·ªè qua cho ƒë·∫øn leading byte ho·∫∑c solo byte ti·∫øp theo.
<br>ƒê√¢y c≈©ng l√† c∆° s·ªü ƒë·ªÉ b·∫°n c√≥ th·ªÉ th·ª±c hi·ªán c√°c thao t√°o nh∆∞ ƒë·∫£o ng∆∞·ª£c chu·ªói m√† kh√¥ng lo l√†m v·ª° ch·ªØ, ƒëo chi·ªÅu d√†i string, l·∫•y substring b·∫±ng index. Trong b√†i ti·∫øp theo, ch√∫ng ta s·∫Ω xem Elixir l√†m nh·ªØng vi·ªác n√†y nh∆∞ th·∫ø n√†o.  Ch√∫ng ta c≈©ng s·∫Ω h·ªçc ƒë∆∞·ª£c l√≠ do t·∫°i sao m√† ‚Äúno√´l‚Äù l·∫°i kh√¥ng gi·ªëng ‚Äúno√´l‚Äù , l√†m sao ƒë·ªÉ vi·∫øt comment l√†m v·ª° layout c·ªßa 1 website, hay t·∫°i sao m√† ƒë·∫øn c·∫£ Elixir c≈©ng kh√¥ng th·ªÉ chuy·ªÉn nh·ªØng k√≠ t·ª± ‚ÄúŒ¶ŒíŒ£‚Äù t·ª´ ch·ªØ hoa th√†nh ch·ªØ th∆∞·ªùng.

# Bonus: gi·∫£i th√≠ch b·∫±ng Python

```python
>>> "√°"
'\xc3\xa1'
>>> "√°".decode("utf-8")
u'\xe1'
>>> bin(0xc3)
'0b11000011'
>>> bin(0xa1)
'0b10100001'
>>> bin(225)
'0b11100001'
```

Ch√∫ng ta th·ª≠ l·∫°i v·ªõi Python. K√≠ t·ª± '√°' c√≥ codepoint l√† 225 (http://www.fileformat.info/info/unicode/char/e1/index.htm) (decode sang utf-8 s·∫Ω c√≥ gi√° tr·ªã hex l√† `0xe1`). 225 chuy·ªÉn sang bit l√†: `11100001`, 8 bit, ta chia th√†nh `11` v√† `100001` (t√°ch s·ªë bit t∆∞∆°ng ·ª©ng v·ªõi s·ªë l∆∞·ª£ng ch·ª©a ƒë∆∞·ª£c trong c√°c byte c·ªßa template t·ª´ ph·∫£i sang tr√°i, tr∆∞·ªùng h·ª£p n√†y ta s·ª≠ d·ª•ng template 2 byte: `110xxxxx 10xxxxxx`). Cu·ªëi c√πng ta ƒë∆∞·ª£c:

```
110xxxxx + 11 = 11000011 = 0xc3
10xxxxxx + 100001 = 10100001 = 0xa1
```

ƒê√∫ng nh∆∞ nh·ªØng g√¨ ta mong ƒë·ª£i :D

# ElixirConf 2016 - String Theory by Nathan Long & James Edward Gray II

{% include youtubePlayer.html id="zZxBL-lV9uA" %}
